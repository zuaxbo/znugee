<!-- files.html -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>檔案管理 - 檔案管理系統</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/files.css">
</head>
<body>
    <div id="app">
        <!-- 導航列 -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-cloud-upload-alt me-2"></i>
                    檔案管理系統
                </a>

                <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
                    <span class="navbar-text me-3">
                        <i class="fas fa-user me-1"></i>
                        {{ currentUser ? currentUser.FullName || currentUser.Username : '未知使用者' }}
                    </span>
                    <button class="btn btn-outline-light btn-sm me-2" @click="goToRecycleBin">
                        <i class="fas fa-trash me-1"></i>
                        資源回收筒
                    </button>
                    <button class="btn btn-outline-light btn-sm" @click="handleLogout">
                        <i class="fas fa-sign-out-alt me-1"></i>
                        登出
                    </button>
                </div>
            </div>
        </nav>

        <!-- 工具列 -->
        <div class="toolbar bg-light border-bottom p-3">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <!-- 左側控制項 -->
                    <div class="col-md-6">
                        <div class="d-flex align-items-center gap-3">
                            <!-- 檢視模式切換 -->
                            <div class="btn-group" role="group">
                                <button type="button"
                                        class="btn btn-outline-secondary"
                                        :class="{ active: viewMode === 'grid' }"
                                        @click="setViewMode('grid')"
                                        title="網格檢視">
                                    <i class="fas fa-th"></i>
                                </button>
                                <button type="button"
                                        class="btn btn-outline-secondary"
                                        :class="{ active: viewMode === 'list' }"
                                        @click="setViewMode('list')"
                                        title="列表檢視">
                                    <i class="fas fa-list"></i>
                                </button>
                            </div>

                            <!-- 上傳按鈕 -->
                            <button class="btn btn-primary" @click="showUploadModal">
                                <i class="fas fa-upload me-2"></i>
                                上傳檔案
                            </button>

                            <!-- 批量操作按鈕 -->
                            <div v-if="selectedFiles.length > 0" class="d-flex align-items-center gap-2">
                                <span class="badge bg-primary">已選擇 {{ selectedFiles.length }} 個檔案</span>
                                <button class="btn btn-sm btn-danger" @click="batchDelete">
                                    <i class="fas fa-trash me-1"></i>
                                    批量刪除
                                </button>
                                <button class="btn btn-sm btn-secondary" @click="clearSelection">
                                    <i class="fas fa-times me-1"></i>
                                    取消選擇
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 右側搜尋和篩選 -->
                    <div class="col-md-6">
                        <div class="d-flex align-items-center gap-2">
                            <!-- 搜尋框 -->
                            <div class="input-group">
                                <input type="text"
                                       class="form-control"
                                       placeholder="搜尋檔案名稱..."
                                       v-model="searchQuery"
                                       @input="onSearchInput">
                                <button class="btn btn-outline-secondary" @click="loadFiles">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>

                            <!-- 排序選擇 -->
                            <select class="form-select" style="width: auto;" v-model="sortOption" @change="onSortChange">
                                <option value="UploadedAt-desc">最新上傳</option>
                                <option value="UploadedAt-asc">最舊上傳</option>
                                <option value="FileName-asc">檔名 A-Z</option>
                                <option value="FileName-desc">檔名 Z-A</option>
                                <option value="FileSize-desc">大小（大到小）</option>
                                <option value="FileSize-asc">大小（小到大）</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主內容區 -->
        <div class="container-fluid py-4">
            <!-- 載入中 -->
            <div v-if="loading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">載入中...</span>
                </div>
                <p class="mt-2">載入檔案中...</p>
            </div>

            <!-- 檔案列表 -->
            <div v-else-if="files.length > 0">
                <!-- 網格檢視 -->
                <div v-if="viewMode === 'grid'" class="row g-3">
                    <div v-for="file in files"
                         :key="file.Id"
                         class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                        <file-grid-item :file="file"
                                        :selected="selectedFiles.includes(file.Id)"
                                        @select="toggleFileSelection"
                                        @preview="showFilePreview"
                                        @download="downloadFile"
                                        @rename="showRenameModal"
                                        @delete="deleteFile"
                                        @copy-link="copyFileLink"></file-grid-item>
                    </div>
                </div>

                <!-- 列表檢視 -->
                <div v-else>
                    <file-list-view :files="files"
                                    :selected-files="selectedFiles"
                                    @select="toggleFileSelection"
                                    @select-all="toggleSelectAll"
                                    @preview="showFilePreview"
                                    @download="downloadFile"
                                    @rename="showRenameModal"
                                    @delete="deleteFile"
                                    @copy-link="copyFileLink"></file-list-view>
                </div>

                <!-- 分頁 -->
                <nav class="mt-4" v-if="totalPages > 1">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" :class="{ disabled: currentPage <= 1 }">
                            <button class="page-link" @click="changePage(currentPage - 1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        </li>

                        <li v-for="page in visiblePages"
                            :key="page"
                            class="page-item"
                            :class="{ active: page === currentPage }">
                            <button class="page-link" @click="changePage(page)">
                                {{ page }}
                            </button>
                        </li>

                        <li class="page-item" :class="{ disabled: currentPage >= totalPages }">
                            <button class="page-link" @click="changePage(currentPage + 1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </li>
                    </ul>
                </nav>
            </div>

            <!-- 空狀態 -->
            <div v-else class="text-center py-5">
                <i class="fas fa-folder-open fa-4x text-muted mb-3"></i>
                <h4 class="text-muted">沒有找到檔案</h4>
                <p class="text-muted">
                    {{ searchQuery ? '請試著使用不同的搜尋關鍵字' : '開始上傳您的第一個檔案吧！' }}
                </p>
                <button v-if="!searchQuery" class="btn btn-primary" @click="showUploadModal">
                    <i class="fas fa-upload me-2"></i>
                    上傳檔案
                </button>
            </div>
        </div>

        <!-- 檔案上傳 Modal -->
        <file-upload-modal v-if="modals.upload"
                           @close="closeUploadModal"
                           @uploaded="onFileUploaded"></file-upload-modal>

        <!-- 檔案預覽 Modal -->
        <file-preview-modal v-if="modals.preview"
                            :file="previewFile"
                            @close="closePreviewModal"></file-preview-modal>

        <!-- 檔案重新命名 Modal -->
        <file-rename-modal v-if="modals.rename"
                           :file="renameFile"
                           @close="closeRenameModal"
                           @renamed="onFileRenamed"></file-rename-modal>
    </div>

    <!-- CDN Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js"></script>
    <script src="https://unpkg.com/http-vue-loader@1.4.2/src/httpVueLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>

    <!-- Utils Scripts -->
    <script src="assets/js/utils/constants.js"></script>
    <script src="assets/js/utils/helpers.js"></script>
    <script src="assets/js/utils/auth.js"></script>
    <script src="assets/js/utils/api.js"></script>
    <script src="assets/js/utils/file-utils.js"></script>
    <script src="assets/js/app.js"></script>

    <!-- Page Script -->
    <script src="assets/js/pages/files.js"></script>
</body>
</html>